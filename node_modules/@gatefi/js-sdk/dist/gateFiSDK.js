!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("gateFiSDK",[],t):"object"==typeof exports?exports.gateFiSDK=t():e.gateFiSDK=t()}(this,(()=>(()=>{"use strict";var e,t,n={d:(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};n.r(i),n.d(i,{GateFiDisplayModeEnum:()=>e,GateFiEventTypes:()=>t,GateFiSDK:()=>S}),function(e){e.Overlay="overlay",e.Embedded="embedded"}(e||(e={})),function(e){e.onLoad="onLoad",e.onInit="onInit",e.onClose="onClose",e.onSetThemeType="onSetThemeType",e._onRedirect="onRedirect"}(t||(t={}));var o,r="gatefi:",s=function(){function e(e){void 0===e&&(e=window),this.debug=!1,this.subscribes={},this.target=e}return e.prototype.send=function(e,t){this.debug&&console.log("[GateFiSDK] send",e),this.target.postMessage({type:this.getTypeWithPrefix(e),payload:t},"*")},e.prototype.start=function(){window.addEventListener("message",this.listenerMessage.bind(this))},e.prototype.stop=function(){window.removeEventListener("message",this.listenerMessage.bind(this))},e.prototype.subscribe=function(e,t){e&&t&&(this.subscribes[e]||(this.subscribes[e]=[]),this.subscribes[e].find((function(e){return e===t}))||this.subscribes[e].push(t))},e.prototype.unsubscribe=function(e,t){this.subscribes[e]&&(this.subscribes[e]=this.subscribes[e].filter((function(e){return e!==t})))},e.prototype.clear=function(){this.subscribes={}},e.prototype.run=function(e,t){this.subscribes[e]&&this.subscribes[e].forEach((function(n){return n(e,t)}))},e.prototype.listenerMessage=function(e){var t=e.data;if(e.isTrusted){var n=t;if(n&&"object"==typeof n&&"string"==typeof n.type&&n.type.startsWith(r)){this.debug&&console.log("[GateFiSDK] receive",e.data);var i=this.getType(n.type);this.run(i,n.payload)}}},e.prototype.getTypeWithPrefix=function(e){return"".concat(r).concat(e)},e.prototype.getType=function(e){return e.replace(r,"")},e}(),a=function(){return a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)},c=new(function(){function e(){this.mediaQuery="(max-width: 540px)"}return e.prototype.createWidget=function(e,t){void 0===t&&(t={});var n=document.createElement("iframe");return n.setAttribute("src",e),Object.assign(n.style,a({width:"420px",height:"680px",border:"none"},t)),n},e.prototype.isNodeExist=function(e){return!!document.querySelector(e)},e.prototype.addListenerOnClick=function(e,t){var n=document.querySelector(e);return n.addEventListener("click",t),function(){n.removeEventListener("click",t)}},e.prototype.addListenerOnScreenSizeChangedToMobile=function(e){var t=window.matchMedia(this.mediaQuery),n=function(t){return e(t.matches)};return t.addEventListener("change",n),function(){t.removeEventListener("change",n)}},e.prototype.isMobileScreen=function(){return window.matchMedia(this.mediaQuery).matches},e}()),d="gatefi-sdk-overlay",l={width:"420px",height:"680px","border-radius":"24px","box-shadow":"0px 12px 24px rgba(6, 13, 51, 0.07)"},u={width:"100%",height:"100%","border-radius":"0px","box-shadow":"none"},p={height:"auto"},f={height:"100%"},h=function(){function e(){this.widget=null,this.overlay=null,this.contentWrapp=null,this.eventListeners=[]}return e.prototype.create=function(e,t){this.overlay=this.createOverlay(),this.contentWrapp=this.createWrapp(),this.widget=c.createWidget(e,c.isMobileScreen()?u:l),this.overlay.appendChild(this.contentWrapp),this.contentWrapp.appendChild(this.widget),document.body.appendChild(this.overlay),t&&this.eventListeners.push(c.addListenerOnClick(t,this.show.bind(this))),this.eventListeners.push(c.addListenerOnScreenSizeChangedToMobile(this.onMobileView.bind(this))),this.eventListeners.push(c.addListenerOnClick("#".concat(d),this.hide.bind(this)))},e.prototype.createOverlay=function(){var e=document.createElement("div");return Object.assign(e.style,{position:"fixed",width:"100%",height:"100%",top:"0",left:"0",right:"0",bottom:"0","background-color":"rgba(0,0,0,0.5)","backdrop-filter":"blur(12px)","z-index":"2",filter:"blur(0)",overflowY:"auto",zIndex:1e3}),e.setAttribute("id",d),e},e.prototype.createWrapp=function(){var e=document.createElement("div");return Object.assign(e.style,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100%"}),e},e.prototype.onMobileView=function(e){Object.assign(this.widget.style,e?u:l),Object.assign(this.contentWrapp.style,e?f:p)},e.prototype.getContentWindow=function(){var e;return(null===(e=this.widget)||void 0===e?void 0:e.contentWindow)||null},e.prototype.destroy=function(){this.widget&&this.overlay&&(this.eventListeners.forEach((function(e){return e()})),this.overlay.remove(),this.overlay=null,this.widget=null)},e.prototype.show=function(){this.overlay&&(this.overlay.style.display="block")},e.prototype.hide=function(){this.overlay&&(this.overlay.style.display="none")},e}(),y=function(){function e(){this.widget=null}return e.prototype.create=function(e,t){this.widget=c.createWidget(e),document.querySelector(t).appendChild(this.widget)},e.prototype.getContentWindow=function(){var e;return(null===(e=this.widget)||void 0===e?void 0:e.contentWindow)||null},e.prototype.destroy=function(){var e;null===(e=this.widget)||void 0===e||e.remove()},e}(),b=function(e,t,n){if(n||2===arguments.length)for(var i,o=0,r=t.length;o<r;o++)!i&&o in t||(i||(i=Array.prototype.slice.call(t,0,o)),i[o]=t[o]);return e.concat(i||Array.prototype.slice.call(t))},g=function(e){try{var t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},m=new(function(){function t(){}return t.prototype.validate=function(t){if(!t.merchantId&&"string"!=typeof t.merchantId)return"merchantId should be a string";if((null==t?void 0:t.isSandbox)&&"boolean"!=typeof t.isSandbox)return"isSandbox should be a boolean";if(!Object.values(e).includes(t.displayMode))return"displayMode: ".concat(t.displayMode," is not exist");if(t.displayMode===e.Embedded&&!t.nodeSelector)return"nodeSelector is a required field for embedded mode";if(t.displayMode===e.Overlay&&c.isNodeExist("#".concat(d)))return"GateFiSDK with 'overlay' display mode already exist";if(t.nodeSelector&&!c.isNodeExist(t.nodeSelector))return"node with id ".concat(t.nodeSelector," does not exist");if(t.successUrl&&!g(t.successUrl))return"successUrl should be a valid URL";if(t.cancelUrl&&!g(t.cancelUrl))return"cancelUrl should be a valid URL";if(t.declineUrl&&!g(t.declineUrl))return"declineUrl should be a valid URL";if((null==t?void 0:t.externalId)&&"string"!=typeof t.externalId)return"externalId should be a string";if((null==t?void 0:t.externalId)&&t.externalId.length>64)return"externalId length should not be more 64 chars";if((null==t?void 0:t.hideAsset)&&"boolean"!=typeof t.hideAsset)return"hideAsset should be a boolean";if(t.assetConfirmation){if("string"!=typeof t.assetConfirmation)return"assetConfirmation should be a string";if(t.assetConfirmation.length>8)return"assetConfirmation should be less 8 chars"}return t.networkConfirmation&&"string"!=typeof t.networkConfirmation?"networkConfirmation should be a string":t.walletConfirmation&&"string"!=typeof t.walletConfirmation?"walletConfirmation should be a string":null},t}()),v=new(function(){function e(){}return e.prototype.send=function(e){console.error("GateFiSDK:",e)},e}()),w=((o={})[e.Overlay]=h,o[e.Embedded]=y,o),S=function(){function e(e){var n,i,o,r,a=this,c=m.validate(e);if(c)v.send(c);else{this.config=e;var d=(n=(null==e?void 0:e.isSandbox)?"https://onramp-sandbox.gatefi.com/":"https://onramp.gatefi.com/",i=new URL(window.location.href),o=new URLSearchParams(i.search),r={},o.forEach((function(e,t){(t.startsWith("gtf")||"merchantId"===t)&&(r[t]=e,o.delete(t))})),i.search=o.toString(),window.history.pushState({},"",i.toString()),function(e,t){if("string"!=typeof e)throw Error("Invalid url type, must be a string. Receive type ".concat(typeof e));if("object"!=typeof t)throw Error("Invalid params type, must be a string. Receive type ".concat(typeof t));var n=new URL(e);return n.search=new URLSearchParams(b(b([],Array.from(new URLSearchParams(n.search).entries()),!0),Object.entries(t),!0)).toString(),n.toString()}(n,r));this.layout=new w[this.config.displayMode],this.layout.create(d,this.config.nodeSelector);var l=this.layout.getContentWindow();l&&(this.pmIframe=new s(l),this.pmIframe.start(),this.pmIframe.subscribe(t.onLoad,(function(){a.pmIframe.send(t.onInit,{merchantId:a.config.merchantId,isSandbox:a.config.isSandbox,walletLock:a.config.walletLock,fiatAmountLock:a.config.fiatAmountLock,cryptoAmountLock:a.config.cryptoAmountLock,fiatCurrencyLock:a.config.fiatCurrencyLock,cryptoCurrencyLock:a.config.cryptoCurrencyLock,displayMode:a.config.displayMode,walletAddress:a.config.walletAddress,email:a.config.email,defaultFiat:a.config.defaultFiat,defaultCrypto:a.config.defaultCrypto,availableCrypto:a.config.availableCrypto,availableFiat:a.config.availableFiat,styles:a.config.styles,isPlaidMode:a.config.isPlaidMode,hideThemeSwitcher:a.config.hideThemeSwitcher,successUrl:a.config.successUrl,cancelUrl:a.config.cancelUrl,declineUrl:a.config.declineUrl,externalId:a.config.externalId,hideAsset:a.config.hideAsset,assetConfirmation:a.config.assetConfirmation,networkConfirmation:a.config.networkConfirmation,walletConfirmation:a.config.walletConfirmation}),a.pmIframe.subscribe(t.onClose,a.hide.bind(a)),a.pmIframe.subscribe(t._onRedirect,a.redirect.bind(a))})))}}return e.prototype.subscribe=function(e,t){var n;null===(n=this.pmIframe)||void 0===n||n.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){var n;null===(n=this.pmIframe)||void 0===n||n.unsubscribe(e,t)},e.prototype.hide=function(){this.layout instanceof h&&this.layout.hide()},e.prototype.setThemeType=function(e){var n;null===(n=this.pmIframe)||void 0===n||n.send(t.onSetThemeType,{type:e})},e.prototype.show=function(){this.layout instanceof h&&this.layout.show()},e.prototype.destroy=function(){var e,t;null===(e=this.pmIframe)||void 0===e||e.stop(),null===(t=this.layout)||void 0===t||t.destroy()},e.prototype.redirect=function(e,t){window.open(t.redirectUrl,"_self")},e}();return i})()));
//# sourceMappingURL=gateFiSDK.js.map